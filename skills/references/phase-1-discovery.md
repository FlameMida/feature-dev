# 阶段 1: 需求理解 (Discovery)

## 目标

全面理解用户需求，识别核心功能、业务实体、API 端点、业务规则和集成点。

---

## 执行步骤

### 1. 仔细阅读用户需求

识别以下关键要素：

- **核心功能**：请求的主要特性/能力是什么？
- **业务实体**：涉及哪些数据模型或领域对象？
- **API 端点**：需要暴露哪些接口？
- **业务规则**：适用哪些约束、验证或特殊逻辑？
- **集成点**：需要与哪些现有系统集成？

### 2. 决定是否使用 ultrathink

根据需求复杂度决定：

#### ✅ 应该使用 ultrathink

- 需求涉及多个模块或系统的集成
- 需求包含复杂的业务逻辑或工作流
- 需求描述模糊或不完整
- 需求之间存在依赖关系或冲突

#### ❌ 不需要 ultrathink

- 单一、明确的需求
- 简单的 CRUD 操作
- 直接的代码修改
- 需求已经非常清晰且范围明确

### 3. 搜索类似实现案例（可选）

了解行业最佳实践和常见模式。

---

## MCP 工具使用

### 优先尝试：exa.web_search_exa

**目的**：搜索类似产品/功能的实现案例，了解行业最佳实践

**示例查询**：
```
"user dashboard analytics implementation best practices"
"real-time notification system architecture"
"multi-tenant SaaS data isolation patterns"
```

**降级方案**：
```
WebSearch: [相同的查询内容]
```

### 复杂需求时尝试：sequential-thinking

**目的**：使用 ultrathink 进行深度需求分析

**使用场景**：参见上方"应该使用 ultrathink"部分

**降级方案**：
- 在响应中使用详细的思维链分析（Chain of Thought）
- 手动进行步骤化分解

**降级示例**：

```markdown
让我逐步分析这个需求：

## 步骤 1: 核心功能拆解
用户提到了"用户仪表板"，这包含：
- 数据展示功能
- 数据筛选功能
- 数据导出功能

## 步骤 2: 业务实体识别
涉及的实体：
- User（用户）
- Dashboard（仪表板配置）
- Widget（仪表板组件）
- DataSource（数据源）

## 步骤 3: API 端点推导
需要的端点：
- GET /api/dashboards - 获取用户仪表板列表
- POST /api/dashboards - 创建仪表板
- GET /api/dashboards/:id/data - 获取仪表板数据

## 步骤 4: 业务规则识别
- 用户只能访问自己的仪表板
- 数据需要根据用户权限过滤
- 实时数据更新频率限制

## 步骤 5: 集成点识别
需要集成：
- 现有的认证系统
- 数据库查询引擎
- WebSocket 服务（实时更新）
```

---

## 输出要求

### 需求理解摘要

输出格式：

```markdown
## 🎯 阶段 1: 需求理解

### 核心功能
- [功能 1]
- [功能 2]
- ...

### 业务实体
- **实体 1**：[描述]
- **实体 2**：[描述]
- ...

### API 端点（初步）
- [方法] [路径] - [描述]
- ...

### 业务规则
- [规则 1]
- [规则 2]
- ...

### 集成点
- [系统 1]：[集成目的]
- [系统 2]：[集成目的]
- ...

### 不确定点（需要澄清）
- [问题 1]
- [问题 2]
- ...
```

---

## 常见问题

### Q: 需求很简单，还需要这么详细分析吗？

A: 简单需求可以简化分析。快速列出核心功能和实体即可，跳过 ultrathink。

### Q: 用户需求描述很模糊怎么办？

A: 做初步分析后，在阶段 3 使用 AskUserQuestion 工具澄清。不要在阶段 1 就打断用户。

### Q: 要搜索多少个案例？

A: 1-3 个代表性案例即可。重点是理解模式，不是收集大量信息。

### Q: 如果找不到类似案例呢？

A: 没关系。基于通用最佳实践进行分析，在后续阶段参考项目现有模式。

---

## 进入下一阶段

完成需求理解后，进入 **阶段 2: 代码库探索**。

参见：[phase-2-exploration.md](phase-2-exploration.md)
