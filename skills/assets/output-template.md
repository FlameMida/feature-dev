# 功能开发输出模板

本模板提供 7 阶段工作流的标准化输出格式。

---

## 🎯 阶段 1: 需求理解

### 核心功能
- [功能 1 描述]
- [功能 2 描述]
- [...]

### 业务实体
- **实体 1**：[描述和主要属性]
- **实体 2**：[描述和主要属性]
- **...**

### API 端点（初步）
- [方法] [路径] - [描述]
- [方法] [路径] - [描述]
- [...]

### 业务规则
- [规则 1：如数据验证规则]
- [规则 2：如权限控制规则]
- [规则 3：如业务约束]
- [...]

### 集成点
- [系统/服务 1]：[集成目的和方式]
- [系统/服务 2]：[集成目的和方式]
- [...]

### 不确定点（需要澄清）
- [问题 1]
- [问题 2]
- [...]

---

## 🔍 阶段 2: 代码库探索结果

### CLAUDE.md 规范
[存在 / 不存在]

**关键规范要点**：
- [规范 1：如代码组织结构]
- [规范 2：如命名约定]
- [规范 3：如错误处理模式]
- [...]

### 项目架构
- **数据层**：[位置、技术、模式]
- **业务逻辑层**：[位置、技术、模式]
- **API 层**：[位置、技术、模式]
- **前端层**（如适用）：[位置、技术、模式]

### 相关组件

**数据层**：
- `path/to/file1` - [描述和作用]
- `path/to/file2` - [描述和作用]

**业务逻辑层**：
- `path/to/file1` - [描述和作用]
- `path/to/file2` - [描述和作用]

**API 层**：
- `path/to/file1` - [描述和作用]
- `path/to/file2` - [描述和作用]

### 识别的设计模式
- **依赖注入**：[使用的方式]
- **数据访问**：[使用的模式，如 Repository、Active Record]
- **错误处理**：[使用的模式]
- **数据验证**：[使用的方式]
- **响应格式**：[API 响应的约定]

### 技术栈确认
- **语言/运行时**：[如 JavaScript/Node.js、Python、Go、Java]
- **框架**：[如 Express、Django、Gin、Spring Boot]
- **数据库**：[如 PostgreSQL、MySQL、MongoDB]
- **ORM/数据库工具**：[如 Sequelize、SQLAlchemy、GORM、JPA]
- **其他关键依赖**：[列表]

### 必读文件清单
1. `path/to/file1` - [为什么要读这个文件]
2. `path/to/file2` - [为什么要读这个文件]
3. [...]

---

## ❓ 阶段 3: 澄清问题

[选项 A：有需要澄清的情况]

我发现以下几点需要确认：

1. **[澄清主题 1]**：[具体问题]
2. **[澄清主题 2]**：[具体问题]
3. **...**

[使用 AskUserQuestion 工具提问]

### 用户反馈
- **[主题 1]**：[用户的选择/回答]
- **[主题 2]**：[用户的选择/回答]
- **...**

已更新需求理解和架构设计计划。

---

[选项 B：无需澄清]

经过分析，需求描述清晰，项目规范完善，无需额外澄清。

可以直接进入架构设计阶段。

---

## 🏗️ 阶段 4: 架构设计

### 数据库设计

#### 实体/表 1：[名称]

**字段**：
| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| [字段1] | [类型] | [如 PK, NOT NULL, UNIQUE] | [说明] |
| [字段2] | [类型] | [约束] | [说明] |
| [...] | [...] | [...] | [...] |

**关联**：
- [关联描述，如：一个用户有多个仪表板]

**索引**：
- [索引名称]：[字段列表] - [目的]

#### 实体/表 2：[名称]

[同上格式]

### API 端点设计

| 方法 | 路径 | 描述 | 认证 | 权限 |
|------|------|------|------|------|
| [GET/POST/PUT/DELETE] | [/api/path] | [描述] | [是/否] | [权限要求] |
| [...] | [...] | [...] | [...] | [...] |

**请求/响应示例**：

```json
// POST /api/[resource] - 创建请求
{
  "field1": "value1",
  "field2": "value2"
}

// 成功响应（200/201）
{
  "id": 1,
  "field1": "value1",
  "field2": "value2",
  "created_at": "2025-01-19T10:00:00Z"
}

// 错误响应（400/401/403/404/500）
{
  "error": "错误类型",
  "message": "详细错误信息"
}
```

### 服务层设计

**服务/类 1：[名称]**

职责：[该服务的主要职责]

方法：
- `method1([参数])` - [描述和返回值]
- `method2([参数])` - [描述和返回值]
- [...]

依赖：
- [依赖的其他服务/组件]

**服务/类 2：[名称]**

[同上格式]

### 数据流程

```
请求 → 验证 → 认证/授权 → 业务逻辑 → 数据访问 → 响应
```

详细流程：
1. [步骤 1 描述]
2. [步骤 2 描述]
3. [...]

### 风险和边缘情况

**并发问题**：
- [问题描述和缓解措施]

**数据一致性**：
- [问题描述和缓解措施]

**性能瓶颈**：
- [潜在瓶颈和优化方案]

**安全风险**：
- [风险和防护措施]

**边缘情况**：
- [场景 1 和处理方式]
- [场景 2 和处理方式]

### 实施步骤

1. **[步骤 1 名称]**
   - 任务：[具体任务描述]
   - 产出：[预期产出]
   - 验证：[如何验证完成]

2. **[步骤 2 名称]**
   - 任务：[具体任务描述]
   - 产出：[预期产出]
   - 验证：[如何验证完成]

3. [...]

---

## ✅ 准备好实施了吗？

我已经设计了完整的架构方案，包括：

✓ 数据库设计（[X] 个实体/表，[Y] 个字段）
✓ API 端点设计（[X] 个端点）
✓ 服务层设计（[X] 个服务）
✓ 详细的实施步骤（[X] 步）

这个方案看起来如何？我可以开始实施了吗？

如果需要调整，请告诉我需要修改的地方。

---

## 🔨 阶段 5: 实施

[在此阶段记录实施过程中的关键信息]

### 实施进度

- [x] 步骤 1：[名称] - ✅ 完成
- [x] 步骤 2：[名称] - ✅ 完成
- [ ] 步骤 3：[名称] - 🚧 进行中
- [ ] 步骤 4：[名称] - ⏸️ 待开始

### 实施说明

**[组件/模块 1]**：
- 文件：`path/to/file`
- 实现：[简要说明]
- 测试：[测试结果]

**[组件/模块 2]**：
- 文件：`path/to/file`
- 实现：[简要说明]
- 测试：[测试结果]

### 实施中的调整
[如果有偏离原设计的地方，记录原因]

---

## 🔍 阶段 6: 质量审查

### 审查统计
- 审查文件数：[X] 个
- 发现问题数：[Y] 个
  - Bug 和逻辑错误：[A] 个
  - 代码质量问题：[B] 个
  - 规范违反：[C] 个

### Bug 和逻辑错误

#### 🔴 高置信度（≥80%）
1. **[问题标题]** (置信度: [%])
   - 文件：`path/to/file:line`
   - 问题：[问题描述]
   - 修复：[修复方案]

2. [...]

#### 🟡 中置信度（50-79%）
[同上格式]

### 代码质量问题

#### 严重
1. **[问题标题]**
   - 文件：`path/to/file:line`
   - 问题：[问题描述]
   - 建议：[改进建议]

2. [...]

#### 一般
[同上格式]

### 规范违反

#### 严重
1. **[问题标题]**
   - 文件：`path/to/file:line`
   - 问题：[违反了哪条规范]
   - 修复：[如何修复]

2. [...]

#### 一般
[同上格式]

### 修复记录

#### 已修复
1. ✅ **[问题标题]** (`path/to/file:line`)
   - 修复内容：[描述]
   - 验证结果：[如何验证]

2. [...]

#### 暂不处理（含原因）
1. ⏸️ **[问题标题]** (`path/to/file:line`)
   - 原因：[为什么暂不处理]
   - 建议：[后续建议]

2. [...]

### 安全确认
- [ ] 输入验证完整
- [ ] 认证和授权正确
- [ ] 无注入漏洞风险
- [ ] 敏感信息处理恰当
- [ ] 错误处理不泄露信息

### 质量评分
- 代码质量：[A-/A/A+]
- 规范遵循：[A-/A/A+]
- 安全性：[A-/A/A+]

**整体评分**：[A-/A/A+]

---

## 📋 阶段 7: 总结

### 🎯 变更摘要

本次实施完成了**[功能名称]**，包括：

✅ [能力 1]
✅ [能力 2]
✅ [能力 3]
✅ [...]

核心能力：
- [能力描述 1]
- [能力描述 2]
- [...]

### 📁 修改文件

#### 新增文件（[X] 个）

**[层次 1，如数据层]**
- `path/to/file1` - [文件作用]
- `path/to/file2` - [文件作用]

**[层次 2，如业务逻辑层]**
- `path/to/file1` - [文件作用]
- `path/to/file2` - [文件作用]

**[层次 3，如 API 层]**
- `path/to/file1` - [文件作用]
- `path/to/file2` - [文件作用]

**[其他，如测试、配置等]**
- `path/to/file1` - [文件作用]
- `path/to/file2` - [文件作用]

#### 修改文件（[Y] 个）
- `path/to/file1` - [修改内容] (+[X] 行, -[Y] 行)
- `path/to/file2` - [修改内容] (+[X] 行, -[Y] 行)

### 🔌 新增 API

| 方法 | 路径 | 描述 | 认证 |
|------|------|------|------|
| [GET/POST/...] | [/api/path] | [描述] | [是/否] |
| [...] | [...] | [...] | [...] |

**权限说明**：
- [权限要求描述]

**请求示例**：

```bash
# [操作描述]
curl -X [METHOD] http://[host]/[path] \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "field": "value"
  }'
```

### 🗄️ 数据库变更

#### 新增表（[X] 个）

**[表名 1]**
| 字段 | 类型 | 约束 | 说明 |
|------|------|------|------|
| [...] | [...] | [...] | [...] |

索引：
- [索引描述]

**[表名 2]**
[同上格式]

#### 修改表（[Y] 个）
- **[表名]**：[修改描述]

#### 迁移执行
```bash
# [执行迁移的命令]
[command]

# [回滚命令（如需要）]
[rollback command]
```

### 🚀 后续建议

#### 1. 测试计划
- [ ] **单元测试**：[测试范围]
- [ ] **集成测试**：[测试场景]
- [ ] **边缘情况测试**：[测试项]
- [ ] **性能测试**：[测试指标]
- [ ] **安全测试**：[测试内容]

#### 2. 部署注意事项
- [ ] **数据库迁移**：[具体操作]
- [ ] **环境变量**：[需要配置的变量]
- [ ] **依赖更新**：[如有新依赖]
- [ ] **日志监控**：[需要监控的日志]
- [ ] **性能监控**：[需要监控的指标]

#### 3. 生成 CHANGELOG

建议添加以下 CHANGELOG 条目：

```markdown
## [版本号] - [日期]

### 新增功能
- [功能描述]
  - [子功能 1]
  - [子功能 2]

### API 变更
- 新增 [X] 个 API 端点
- 详见 API 文档

### 数据库变更
- 新增 [表名] 表
- [其他变更]

### 技术改进
- [改进 1]
- [改进 2]
```

#### 4. 生成/更新 API 文档

```bash
# [文档生成命令]
[command]

# [文档访问地址]
[URL]
```

#### 5. 可选功能扩展
- **[扩展功能 1]**：[描述和价值]
- **[扩展功能 2]**：[描述和价值]
- **[扩展功能 3]**：[描述和价值]

#### 6. 性能优化建议
- [优化建议 1]
- [优化建议 2]
- [优化建议 3]

#### 7. 监控指标
建议监控以下指标：
- [指标 1]
- [指标 2]
- [指标 3]

### 🔧 工具使用情况

#### MCP 工具
- [✅/⏸️] **context7**：[可用/不可用]，查询了 [X] 次
- [✅/⏸️] **exa**：[可用/不可用]，搜索了 [X] 次
- [✅/⏸️] **sequential-thinking**：[可用/不可用]，用于 [哪些阶段]

#### 降级工具
- [✅/⏸️] [使用/未使用]降级方案
- [如使用，说明哪些阶段使用了哪些降级工具]

#### Agents
- [✅/⏸️] **code-explorer**：启动 [X] 个，探索时间约 [X] 分钟
- [✅/⏸️] **code-architect**：[使用/未使用]
- [✅/⏸️] **code-reviewer**：启动 [X] 个，发现 [X] 个问题

---

## ✅ 功能开发完成

7 阶段工作流已全部完成：
- ✓ 阶段 1: 需求理解
- ✓ 阶段 2: 代码库探索
- ✓ 阶段 3: 澄清问题
- ✓ 阶段 4: 架构设计
- ✓ 阶段 5: 实施
- ✓ 阶段 6: 质量审查
- ✓ 阶段 7: 总结

还有其他需要帮助的吗？

---

## ⚠️ 重要提醒：阶段标记

**所有输出必须包含阶段标记**

### 阶段开始标记
```markdown
---
## 🚀 当前阶段：[X] - [阶段名称]
---
```

### 阶段结束标记
```markdown
---
✅ 阶段 [X] 完成

📍 下一阶段：[X+1] - [阶段名称]
---
```

### 用户输入后继续标记
```markdown
---
📥 已收到用户输入/反馈

🔄 继续阶段 [X] - [阶段名称]
---
```

这些标记**不是可选的**，它们确保工作流连续性和状态清晰。
