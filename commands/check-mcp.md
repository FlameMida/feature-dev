---
description: 检查 MCP 配置状态，显示插件和全局 MCP 的详细信息
---

# MCP 配置检查

正在检查您的 MCP 配置状态...

## 任务说明

请执行以下操作来检查 MCP 配置：

### 1. 读取配置文件

- 读取用户全局配置：`~/.claude/config.json`（如果存在）
- 读取插件 MCP 配置：当前插件目录下的 `.mcp.json`

### 2. 检查以下 MCP 服务器

需要检查的 MCP 服务器：
- `context7` - 最新库文档和 API 参考
- `exa` - 高质量网页搜索
- `sequential-thinking` - 深度结构化思考

### 3. 生成配置状态报告

请以清晰的格式展示：

#### 配置状态表格

| MCP 服务器 | 全局配置 | 插件配置 | 实际使用 | 状态 |
|-----------|---------|---------|---------|------|
| context7 | ✅/❌ | ✅/❌ | 全局/插件/未配置 | 正常/需配置/需API Key |
| exa | ✅/❌ | ✅/❌ | 全局/插件/未配置 | 正常/需配置/需API Key |
| sequential-thinking | ✅/❌ | ✅/❌ | 全局/插件/未配置 | 正常/需配置 |

#### 优先级说明

说明 Claude Code 的作用域优先级机制：
- 🥇 **本地作用域** - 最高优先级
- 🥈 **项目作用域** - 中等优先级
- 🥉 **用户作用域** - 最低优先级（全局配置和插件配置都属于此级别）

如果在同一作用域内存在同名 MCP：
- 全局配置（~/.claude/config.json）优先于插件配置

#### 环境变量检查

检查必需的环境变量：
- `CONTEXT7_API_KEY` - context7 所需
- `EXA_API_KEY` - exa 所需

对于每个环境变量：
- ✅ 已配置
- ❌ 未配置（如果 MCP 需要但未设置）
- ➖ 不适用（如果该 MCP 未在使用中）

### 4. 提供配置建议

根据检查结果提供个性化建议：

**如果所有 MCP 都已正确配置**：
```
✅ 所有 MCP 配置正常！插件功能已就绪。
```

**如果检测到用户已有全局配置**：
```
ℹ️  检测到您已在全局配置中安装了以下 MCP：
  • context7
  • exa

您的全局配置会自动优先于插件配置，这是完全正常的。
插件功能将使用您的配置正常工作。
```

**如果有 MCP 未配置**：
```
⚠️  以下 MCP 未配置，建议安装以获得最佳体验：
  • context7

安装方式：
1. 将插件 .mcp.json 中的配置复制到 ~/.claude/config.json
2. 或者让插件自动提供的配置生效（无需手动操作）
```

**如果缺少 API Key**：
```
⚠️  以下环境变量未配置：
  • CONTEXT7_API_KEY
  • EXA_API_KEY

设置方式：
# 在 ~/.zshrc 或 ~/.bashrc 中添加
export CONTEXT7_API_KEY="your-api-key"
export EXA_API_KEY="your-api-key"

获取 API Key:
  • Context7: https://context7.com/
  • Exa: https://exa.ai/
```

### 5. 展示配置来源详情（可选）

如果用户想了解更多细节，可以展示：
- 每个 MCP 的完整配置（command、args、env）
- 配置文件路径
- 版本信息（如果可获取）

## 注意事项

- 如果无法读取 ~/.claude/config.json（权限问题），优雅降级，仅显示插件配置
- 使用清晰的图标和格式，便于快速理解
- 保持输出简洁，避免过多技术细节
- 提供可操作的建议，而不是抽象的说明
